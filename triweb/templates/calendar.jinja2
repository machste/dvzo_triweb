{% extends "layout.jinja2" %}

{% macro month_card(month) -%}
<div class="card cal-month">
  <div class="card-body">
    <div class="card-title">{{ month_titles[month] }}</div>
  </div>
</div>
{%- endmacro %}

{% macro workday_card(workday) -%}
<div class="card cal-workday">
  <div class="card-header">
    <div class="workday-datetime">
      <div class="workday-date"><span convert="to_date">{{ workday.date }}</span></div>
      <div class="workday-time">
        <i class="bi bi-clock me-2"></i>{{ workday.start_time.hour }}<sup>{{ '%02d' % workday.start_time.minute }}</sup> - {{ workday.end_time.hour }}<sup>{{ '%02d' % workday.end_time.minute }}</sup>
      </div>
    </div>
    {% if workday.cook %}
      <div class="workday-cook"></div>
    {% endif %}
  </div>
  <div class="card-body">
    <div class="workday-badges">
      {% if workday.vehicle is not none %}
        <span class="badge badge-lok lok-godfather-1">{{ workday.vehicle.short_name or workday.vehicle.name }}</span>
      {% else %}
        <div class="workday-badges"><span class="badge badge-workshop">Werkstatt</span></div>
      {% endif %}
    </div>
    <div class="card-title">{{ workday.title }}</div>
    {% if workday.description is not none %}
      {{ workday.description | md_to_html }}
    {% endif %}
  </div>
  <div class="card-body d-flex justify-content-between align-items-center">
    <div class="workday-lead-icon" data-bs-toggle="tooltip" data-bs-title="Leitung: {{ workday.manager.display_name }}">
      <i class="bi bi-person-gear"></i>
    </div>
    <div class="btn-group btn-group-sm" role="group">
      <input type="radio" class="btn-check" name="btnradio{{ workday.id }}" id="btnradio{{ workday.id }}-1">
      <label class="btn btn-outline-danger" for="btnradio{{ workday.id }}-1" data-bs-toggle="tooltip" data-bs-title="Nein"><i class="bi bi-x-circle"></i></label>
      <input type="radio" class="btn-check" name="btnradio{{ workday.id }}" id="btnradio{{ workday.id }}-2">
      <label class="btn btn-outline-warning" for="btnradio{{ workday.id }}-2" data-bs-toggle="tooltip" data-bs-title="Möglich"><i class="bi bi-check"></i></label>
      <input type="radio" class="btn-check" name="btnradio{{ workday.id }}" id="btnradio{{ workday.id }}-3">
      <label class="btn btn-outline-success" for="btnradio{{ workday.id }}-3" data-bs-toggle="tooltip" data-bs-title="Ja"><i class="bi bi-check-circle"></i></label>
    </div>
  </div>
</div>
{%- endmacro %}


{% block head %}
<link rel="stylesheet" href="{{ request.static_url('triweb:static/css/calendar.css') }}">
{% endblock head %}

{% block content %}
<div class="container content">
  <h1>Werkstattkalender</h1>
  <p>
    Bitte tragt eure Verfügbarkeit für die einzelnen Arbeitstage, Events oder
    Seminaren im untenstehenden Kalender ein. Die Leiter des jeweiligen Anlasses
    werden sich etwa eine Woche vor dem Termin bei euch mit weiteren
    Informationen melden. Anpassungen und Ergänzungen im Werkstattkalender
    werden zeitnah kommuniziert.
  </p>
  <p>
    Jeder Eintrag im Werkstattkalender wird als verbindliche An- oder Abmeldung
    zum jeweiligen Anlass verstanden.
  </p>
  <div class="row my-4 g-2">
    {% for column in columns %}
      <div class="col col-xxl-2 col-lg-3 col-md-4 col-sm-6">
        {% for month in column %}
          {{ month_card(month.num) }}
          {% for workday in month.workdays %}
            {{ workday_card(workday) }}
          {% endfor %}
        {% endfor %}
      </div>
    {% endfor %}
  </div>
</div>
<script>
  const tooltip_elements = document.querySelectorAll('[data-bs-toggle="tooltip"]')
  let tooltips = []
  for (el of tooltip_elements) {
    tooltips.push(new bootstrap.Tooltip(el))
  }

  const date_elements = document.querySelectorAll("span[convert=to_date]");
  for (el of date_elements) {
    d = any_to_date(el.innerText);
    el.innerText = d.toLocaleDateString('de', {weekday:'short', day:'numeric', month:'numeric'})
  }
</script>
{% endblock content %}
